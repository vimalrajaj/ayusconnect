<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyushConnect - FHIR R4 Terminology Bridge</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="session-manager.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    <h1>AyushConnect</h1>
                    <span class="tagline">FHIR R4 Terminology Bridge</span>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-section="search">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button class="nav-btn" data-section="fhir">
                        <i class="fas fa-code"></i> FHIR Builder
                    </button>
                    <button class="nav-btn" data-section="analytics">
                        <i class="fas fa-chart-line"></i> Analytics
                    </button>
                    <button class="nav-btn" data-section="api-docs" onclick="loadApiDocumentation()">
                        <i class="fas fa-book"></i> API Docs
                    </button>
                </nav>
                <div class="language-switcher">
                    <select id="languageSelect" class="form-control">
                        <option value="en">English</option>
                        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                        <option value="ta">‡Æ§‡ÆÆ‡¶ø‡Æ¥‡Øç</option>
                        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    </select>
                </div>
                <div class="auth-link">
                    <a href="login.html" class="btn btn--secondary btn--sm" title="View OAuth Authentication System">
                        <i class="fas fa-shield-alt"></i> OAuth Login
                    </a>
                </div>
                <div class="user-session hidden" id="userSession">
                    <div class="session-info">
                        <div class="user-avatar">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="user-details">
                            <span class="user-name" id="userName">Dr. User</span>
                            <span class="user-role" id="userRole">Authenticated</span>
                        </div>
                    </div>
                    <div class="session-controls">
                        <button class="session-btn" id="sessionTimeBtn" title="Session time remaining">
                            <i class="fas fa-clock"></i>
                            <span id="sessionTimer">30:00</span>
                        </button>
                        <button class="session-btn logout-btn" id="logoutBtn" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="theme-switcher">
                    <button id="themeToggleBtn" class="theme-btn" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Search Section -->
        <section id="search-section" class="section active">
            <div class="container">
                <!-- NAMASTE to ICD-10 Search Interface -->
                <div class="search-container">
                    <div class="search-header">
                        <h2>üè• NAMASTE to ICD-10 Diagnosis Mapping</h2>
                        <p>Search traditional AYUSH diagnoses and save standardized ICD-10 codes to patient records</p>
                    </div>

                    <!-- Patient Information -->
                    <div class="demo-section">
                        <h3>üë§ Patient Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Patient ID</label>
                                <input type="text" id="demoPatientId" class="form-control" value="P12345" placeholder="Enter Patient ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Visit ID</label>
                                <input type="text" id="demoVisitId" class="form-control" value="V98765" placeholder="Enter Visit ID">
                            </div>
                        </div>
                    </div>

                    <!-- Live Search -->
                    <div class="demo-section">
                        <h3>üîç Diagnosis Search</h3>
                        <div class="form-group">
                            <label class="form-label">Search for Diagnosis:</label>
                            <input type="text" id="demoSearchInput" class="form-control" 
                                   placeholder="Try: fever, diabetes, asthma, hypertension, malaria..." autocomplete="off">
                            <small class="form-text">Start typing to see real-time API results</small>
                        </div>
                        
                        <!-- Quick Test Buttons -->
                        <div class="test-buttons">
                            <button class="btn btn--primary btn--sm" onclick="testApiSearch('fever')">
                                <i class="fas fa-thermometer-half"></i> Fever
                            </button>
                            <button class="btn btn--primary btn--sm" onclick="testApiSearch('diabetes')">
                                <i class="fas fa-heartbeat"></i> Diabetes
                            </button>
                            <button class="btn btn--primary btn--sm" onclick="testApiSearch('asthma')">
                                <i class="fas fa-lungs"></i> Asthma
                            </button>
                            <button class="btn btn--primary btn--sm" onclick="testApiSearch('hypertension')">
                                <i class="fas fa-tachometer-alt"></i> Hypertension
                            </button>
                            <button class="btn btn--secondary btn--sm" onclick="clearResults()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                        
                        <div id="demoSearchResults" class="demo-results"></div>
                    </div>

                    <!-- API Status -->
                    <div class="demo-section">
                        <h3>üì° API Status</h3>
                        <div class="api-status">
                            <div class="status-indicator">
                                <div id="apiStatusDot" class="status-dot active"></div>
                                <span id="apiStatusText">API Online</span>
                            </div>
                            <div class="endpoint-info">
                                <strong>Search Endpoint:</strong> <code>GET http://127.0.0.1:8000/api/search</code><br>
                                <strong>Save Endpoint:</strong> <code>POST http://127.0.0.1:8000/api/save</code>
                            </div>
                        </div>
                    </div>

                    <!-- Saved Records -->
                    <div class="demo-section">
                        <h3>üíæ Patient Records</h3>
                        <div id="savedRecords" class="saved-records">
                            <p class="no-records">No records saved yet. Search and save diagnoses above.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FHIR Builder Section -->
        <section id="fhir-section" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>FHIR R4 Bundle Generator</h2>
                    <p>Generate HL7 FHIR R4 compliant bundles for selected conditions</p>
                </div>

                <div class="fhir-builder">
                    <div class="builder-form">
                        <div class="form-group">
                            <label class="form-label">Patient ID</label>
                            <input type="text" id="patientId" class="form-control" 
                                   value="patient-123" placeholder="Enter Patient ID">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Selected Conditions</label>
                            <div class="selected-conditions" id="selectedConditions">
                                <div class="condition-placeholder">
                                    Search and select conditions from the terminology search to add them here
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <button class="btn btn--primary" id="generateBundle">
                                <i class="fas fa-code"></i> Generate FHIR Bundle
                            </button>
                        </div>
                    </div>

                    <div class="bundle-preview">
                        <div class="preview-header">
                            <h3>Bundle Preview</h3>
                            <div class="preview-actions">
                                <button class="btn btn--secondary" id="copyBundle">
                                    <i class="fas fa-copy"></i> Copy JSON
                                </button>
                                <button class="btn btn--secondary" id="downloadBundle">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <div class="validation-status" id="validationStatus">
                                    <i class="fas fa-check-circle"></i> FHIR R4 Valid
                                </div>
                            </div>
                        </div>
                        <pre class="json-preview" id="bundleJson">
{
  "resourceType": "Bundle",
  "id": "ayush-terminology-bundle",
  "meta": {
    "profile": ["http://hl7.org/fhir/StructureDefinition/Bundle"],
    "lastUpdated": "2025-09-07T09:00:00.000Z"
  },
  "type": "collection",
  "entry": []
}
                        </pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Analytics Dashboard</h2>
                    <p>Real-time insights into AYUSH terminology usage patterns</p>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>System Distribution</h3>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="systemChart"></canvas>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Confidence Score Distribution</h3>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="confidenceChart"></canvas>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Popular Terms</h3>
                        <div class="popular-terms" id="popularTerms">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Real-time Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-value" id="dailySearches">2,847</div>
                                <div class="metric-label">Daily Searches</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="activeDoctors">1,205</div>
                                <div class="metric-label">Active Doctors</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="bundlesGenerated">456</div>
                                <div class="metric-label">FHIR Bundles</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="successRate">98.7%</div>
                                <div class="metric-label">Success Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- API Documentation Section -->
        <section id="api-docs-section" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>üìö API Documentation for EMR Integration</h2>
                    <p>Complete API reference for integrating NAMASTE to ICD-10 mapping into your EMR system</p>
                </div>

                <div class="api-docs-container">
                    <!-- API Overview -->
                    <div class="api-overview">
                        <div class="overview-card">
                            <h3>üè• NAMASTE to ICD-10 Mapping API</h3>
                            <p><strong>Version:</strong> 1.0.0</p>
                            <p><strong>Base URL:</strong> <code id="baseUrl">http://127.0.0.1:8000</code></p>
                            <p><strong>Format:</strong> JSON</p>
                            <div class="api-status-indicator">
                                <div id="docsApiStatus" class="status-dot active"></div>
                                <span id="docsApiStatusText">API Online</span>
                            </div>
                        </div>
                    </div>

                    <!-- Load API Documentation Button -->
                    <div class="load-docs-section">
                        <button class="btn btn--primary" id="loadApiDocs" onclick="loadApiDocumentation()">
                            <i class="fas fa-download"></i> Load Latest API Documentation
                        </button>
                        <p class="load-docs-note">Click to fetch the latest API endpoints and examples from the server</p>
                    </div>

                    <!-- API Endpoints Documentation -->
                    <div id="apiEndpointsContainer" class="endpoints-container">
                        <div class="loading-message">
                            <i class="fas fa-info-circle"></i>
                            Click "Load Latest API Documentation" above to view available endpoints
                        </div>
                    </div>

                    <!-- Integration Guide -->
                    <div class="integration-guide">
                        <h3>üîß EMR Integration Guide</h3>
                        <div class="integration-steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>Setup Base URL</h4>
                                    <p>Update the base URL in your EMR system to point to your NAMASTE API server</p>
                                    <code>const API_BASE = "http://your-server.com";</code>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>Search Integration</h4>
                                    <p>Use the search endpoint for autocomplete functionality in diagnosis fields</p>
                                    <code>GET /api/search?query={userInput}</code>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>Save to Patient Record</h4>
                                    <p>Save selected diagnosis mappings directly to patient records</p>
                                    <code>POST /api/save</code>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h4>Error Handling</h4>
                                    <p>Implement proper error handling for network issues and API responses</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Code Examples -->
                    <div class="code-examples">
                        <h3>üíª Code Examples</h3>
                        <div class="example-tabs">
                            <button class="example-tab active" data-lang="javascript">JavaScript</button>
                            <button class="example-tab" data-lang="python">Python</button>
                            <button class="example-tab" data-lang="curl">cURL</button>
                        </div>
                        <div class="example-content">
                            <div class="example-panel active" id="javascript-example">
                                <pre><code>// Search for diagnosis
async function searchDiagnosis(query) {
    try {
        const response = await fetch(`${API_BASE}/api/search?query=${query}`);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Search failed:', error);
    }
}

// Save to patient record
async function saveDiagnosis(patientId, visitId, namasteCode, icd10Code) {
    try {
        const response = await fetch(`${API_BASE}/api/save`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                patient_id: patientId,
                visit_id: visitId,
                namaste_code: namasteCode,
                icd10_code: icd10Code
            })
        });
        return await response.json();
    } catch (error) {
        console.error('Save failed:', error);
    }
}</code></pre>
                            </div>
                            <div class="example-panel" id="python-example">
                                <pre><code>import requests

# Search for diagnosis
def search_diagnosis(query):
    try:
        response = requests.get(f"{API_BASE}/api/search", params={"query": query})
        return response.json()
    except Exception as e:
        print(f"Search failed: {e}")

# Save to patient record
def save_diagnosis(patient_id, visit_id, namaste_code, icd10_code):
    try:
        response = requests.post(f"{API_BASE}/api/save", json={
            "patient_id": patient_id,
            "visit_id": visit_id,
            "namaste_code": namaste_code,
            "icd10_code": icd10_code
        })
        return response.json()
    except Exception as e:
        print(f"Save failed: {e}")</code></pre>
                            </div>
                            <div class="example-panel" id="curl-example">
                                <pre><code># Search for diagnosis
curl "http://127.0.0.1:8000/api/search?query=fever"

# Save to patient record
curl -X POST "http://127.0.0.1:8000/api/save" \
     -H "Content-Type: application/json" \
     -d '{
       "patient_id": "P12345",
       "visit_id": "V98765",
       "namaste_code": "AYU-J001",
       "icd10_code": "R50.9"
     }'</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Processing...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>